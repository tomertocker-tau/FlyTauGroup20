<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Account</title>
</head>
<body>

<h2>Search Flight</h2>

<form id="flight_search_form" action="/flights" method="post">
  <datalist id="airports_list">
    {% for airport in airports %}
      <option value="{{ airport.name }} ({{ airport.code }})"></option>
    {% endfor %}
  </datalist>

  <table>
    <tr>
      <td>
        <label for="origin">From (Airport):</label><br>
        <input
          type="text"
          id="origin"
          name="origin"
          list="airports_list"
          placeholder="Start typing..."
          required>
      </td>

      <td>
        <label for="destination">To (Airport):</label><br>
        <input
          type="text"
          id="destination"
          name="destination"
          list="airports_list"
          placeholder="Start typing..."
          required>
      </td>

      <td>
        <label for="departure_date">Departure Date:</label><br>
        <input
          type="date"
          id="departure_date"
          name="departure_date"
          required>
      </td>

      <td>
        <label for="passengers">Passengers:</label><br>
        <input
          type="number"
          id="passengers"
          name="passengers"
          min="1"
          step="1"
          required>
      </td>

      <td>
        <br>
        <button type="submit">Search Flights</button>
      </td>
    </tr>
  </table>
</form>

<hr>

<h2>Purchase History</h2>

<form id="status_filter_form" method="get" action="/flight-booking">
  <label for="status">Filter by status:</label>

  <select id="status" name="status">
    <option value="" {% if not selected_status %}selected{% endif %}>All</option>
    <option value="Active" {% if selected_status == "Active" %}selected{% endif %}>Active</option>
    <option value="Completed" {% if selected_status == "Completed" %}selected{% endif %}>Completed</option>
    <option value="Customer_Cancelled" {% if selected_status == "Customer_Cancelled" %}selected{% endif %}>Customer Cancelled</option>
    <option value="System_Cancelled" {% if selected_status == "System_Cancelled" %}selected{% endif %}>System Cancelled</option>
  </select>

  <button type="submit">Apply</button>
</form>

<br><br>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Order Number</th>
      <th>Source</th>
      <th>Destination</th>
      <th>Flight Date</th>
      <th>Class</th>
      <th>Seats</th>
      <th>Price</th>
      <th>Status</th>
      <th>Cancel</th>
    </tr>
  </thead>

  <tbody>
    {% for row in orders %}
      <tr>
        <td>{{ row.OrderID }}</td>
        <td>{{ row.SourceField }}</td>
        <td>{{ row.DestinationField }}</td>
        <td>{{ row.TakeOffTime }}</td>

        <td>{{ row.ClassType }}</td>
        <td>{{ row.NumSeats }}</td>

        <td>{{ row.OrderPrice }}</td>
        <td>{{ row.OrderStatus }}</td>

        <td>
          {% if row.OrderStatus == "Customer_Cancelled" or row.OrderStatus == "System_Cancelled" %}
            <button type="button" disabled>Cancel</button>
          {% else %}
            <form id="flight_cancel_{{ row.OrderID }}" method="post" action="/cancel_confirmation">
              <input type="hidden" name="order_id" value="{{ row.OrderID }}">
              <button type="submit">Cancel</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}

    {% if orders|length == 0 %}
      <tr>
        <td colspan="9" style="text-align:center;">No orders found.</td>
      </tr>
    {% endif %}
  </tbody>
</table>

</body>
</html>